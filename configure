#!/bin/sh
#
# $Id: configure,v 1.24 2005/11/23 12:23:04 tho Exp $

export makl_conf_h=klone_conf.h

# Be sure MAKL_DIR is there.
# If not found assume MaKL has been embedded in the package.
if [ -z "${MAKL_DIR}" ]
then
    if [ -d `pwd`/makl ]
    then
        export MAKL_DIR=`pwd`/makl
    else
        echo "MaKL MUST be installed and MAKL_DIR set in the environment"
        exit 1
    fi
fi

# MaKL preamble
. ${MAKL_DIR}/cf/makl.init

# Preprocess arguments
makl_args_init "$@"

# Custom arguments ...
makl_args_def   "enable_debug"      "" ""   "enables debugging"
makl_args_def   "enable_profile"    "" ""   "enables profiling"
makl_args_def   "enable_sup_fs"     "" ""   "enables filesystem web access"
# ... and their handlers
__makl_enable_debug ()      { makl_add_var_mk   "CFLAGS" "-g" ; }
__makl_enable_profile ()    { makl_add_var_mk   "CFLAGS" "-pg -a" ; }
__makl_enable_sup_fs ()     { makl_set_var_h    "ENABLE_SUP_FS" ; }

# General settings
makl_pkg_name           "klone"
makl_pkg_version

# be sure that the libu is installed
makl_require        "lib"       "u"   "-I`pwd`/libu"  "`pwd`/libu/src/libu.a"
makl_add_var_mk     "CFLAGS"    "-I`pwd`/libu"

case `makl_os_name` in

    *mingw* | *MINGW*)
        makl_set_var_h      "OS_WIN"
        makl_add_var_mk     "LIBS"      "-lwsock32 -L/c/WINDOWS" 
        ;;

    freebsd4*)
        makl_set_var_h      "OS_UNIX"
        makl_require        "lib"       "openssl"   ""  "-lssl -lcrypto"
        ;;

    *)
        makl_set_var_h      "OS_UNIX"
        makl_require        "lib"       "openssl"   ""  "-lssl -lcrypto"
        makl_checkheader    1           "stdint"    "<stdint.h>"
        ;;
esac

makl_add_var_mk "CFLAGS" "-W -Wall -Wpointer-arith -Wno-uninitialized" \
                         "-I`pwd`" \
                         "-Wreturn-type -Wcast-qual -Wwrite-strings" \
                         "-Wswitch -Wshadow" \
                         "-DHAVE_CONF_H"

# Binary dependencies
makl_optional           1   "featx"  "doxygen"  "PATH_DOXYGEN" 

# Library dependencies
makl_optional           1   "lib"       "z"  

# Function dependencies
makl_checktype          0   "pid_t"     "<sys/types.h>" 

# Handle command-line arguments
makl_args_handle "$@"

. ${MAKL_DIR}/cf/makl.term
